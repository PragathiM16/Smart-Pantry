<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="overlay">

<h2>ðŸ¥— My Pantry</h2>

<!-- DASHBOARD -->
<div class="stats">
  <div>Total Items<br><b>{{ stats.total }}</b></div>
  <div>Expiring Soon<br><b>{{ stats.soon }}</b></div>
  <div>Safe Items<br><b>{{ stats.safe }}</b></div>
</div>

<!-- GRAPH -->
<canvas id="chart"></canvas>

<script>
new Chart(document.getElementById("chart"), {
  type: "pie",
  data: {
    labels: ["Safe", "Expiring Soon"],
    datasets: [{
      data: [{{ stats.safe }}, {{ stats.soon }}],
      backgroundColor: ["#2ecc71", "#e67e22"]
    }]
  }
});
</script>

<!-- ADD ITEM -->
<div class="card">
<form method="POST" action="/add">
<label>Food Item</label>
<input name="name" required>
<label>Expiry Date</label>
<input type="date" name="expiry" required>
<button>Add Item</button>
</form>
</div>

<!-- SEARCH -->
<input type="text" id="search" placeholder="Search food..." onkeyup="filter()">

<!-- ITEMS -->
{% for item in items %}
<div class="pantry-item {{ 'danger' if item.days_left <= 3 else 'warning' if item.days_left <= 7 else 'safe' }}">
<img src="{{ item.image }}">
<div>
<b>{{ item.name }}</b><br>
Expires: {{ item.expiry }}<br>
Days left: {{ item.days_left }}<br>
<a href="/delete/{{ item._id }}">ðŸ—‘ Remove</a>
</div>
</div>
{% endfor %}

<a href="/logout"><button>Logout</button></a>

</div>

<script>
function filter(){
  let q = document.getElementById("search").value.toLowerCase();
  document.querySelectorAll(".pantry-item").forEach(i=>{
    i.style.display = i.innerText.toLowerCase().includes(q) ? "flex" : "none";
  });
}
</script>

</body>
</html>
